#react

# Race Condition í•´ê²° ë°©ë²•

`Race Condition` ì˜ í•´ê²° ì˜ˆì‹œì´ë‹¤.
```typescript
 useEffect(() => {
    let ignore = false;
    const request = async (requestId) => {
      setIsLoading(true);
      await sleep(Math.random() * 3000);
      if (!ignore) {
        setResponse(requestId);
        setIsLoading(false);
      }
    }
    request(counter);
    
    return () => {
      ignore = true;
    }
  }, [counter]);
```

ì´ë²¤íŠ¸ê°€ ë‹¤ìˆ˜ê°€ ë°œìƒí•˜ì—¬ ì½œë°±ì´ ìˆ˜í–‰ë  ë•Œ, í•´ë‹¹ ì½œë°±ì˜ ì‹¤í–‰ìƒíƒœë¥¼ `cleanup` í•¨ìˆ˜ì—ì„œ ì œì–´í•¨ìœ¼ë¡œì¨ `Race Condition` ì„ íšŒí”¼í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ëŠ” í˜„ìƒì„ ìƒì„¸íˆ ì •ì˜í•˜ì˜€ë‹¤.

### **ë¬¸ì œ: Race Condition**
- `useEffect` ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° ì‘ì—…ì´ ì‹¤í–‰ë˜ê³ , ì˜ì¡´ì„±(`counter`)ì´ ë³€ê²½ë˜ì–´ ìƒˆ ì‘ì—…ì´ íŠ¸ë¦¬ê±°ë˜ë©´ ì´ì „ ì‘ì—…ë„ ì—¬ì „íˆ ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤.
- ì´ë¡œ ì¸í•´ ì˜¤ë˜ ê±¸ë¦° ì´ì „ ì‘ì—…ì´ ë‚˜ì¤‘ì— ì™„ë£Œë˜ë©´ì„œ ìƒíƒœë¥¼ ë®ì–´ì“°ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

---

### **í•´ê²° ë°©ë²•: Cleanup í•¨ìˆ˜ë¡œ ìƒíƒœ ì œì–´**

1. **`ignore` í”Œë˜ê·¸ ì‚¬ìš©**
    
    - ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰ ì‹œ, `ignore` í”Œë˜ê·¸ë¥¼ í™œìš©í•´ ì´ì „ ì‘ì—…ì„ ë¬´íš¨í™”í•œë‹¤.
    - `cleanup` í•¨ìˆ˜ì—ì„œ `ignore = true`ë¥¼ ì„¤ì •í•˜ì—¬ ì´ì „ ì‘ì—…ì˜ ìƒíƒœ ë³€ê²½ì„ ë°©ì§€í•œë‹¤.
2. **ë¡œì§ ì„¤ëª…**
    
    - `request` í•¨ìˆ˜ëŠ” `counter`ì˜ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ë¹„ë™ê¸° ì‘ì—…ì„ ì‹¤í–‰í•œë‹¤.
    - `cleanup` í•¨ìˆ˜(`return () => { ignore = true; }`)ëŠ” `useEffect`ê°€ ë‹¤ì‹œ í˜¸ì¶œë  ë•Œ ì‹¤í–‰ë˜ë©°, ì´ì „ ì‘ì—…ì„ ë¬´íš¨í™”í•œë‹¤.
    - ë¬´íš¨í™”ëœ ì‘ì—…ì€ `ignore` ì¡°ê±´ì— ì˜í•´ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤.

---

### **ì¥ì **

- ì—¬ëŸ¬ ì´ë²¤íŠ¸ë¡œ ì¸í•´ ì½œë°±ì´ ë™ì‹œì— ì‹¤í–‰ë˜ë”ë¼ë„, ìµœì‹  ìƒíƒœë§Œ ë°˜ì˜ë˜ì–´ **Race Condition**ì„ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
- ì½”ë“œê°€ ê°„ë‹¨í•˜ê³  Reactì˜ `useEffect` íŒ¨í„´ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©ëœë‹¤.

# ë°ì´í„° íë¦„ ë§ì¹˜ê¸°
```typescript
function Parent() {
  const [data, setData] = useState(null);

  return <Child onFetched={setData} />;
}

// ğŸ”´ Effect ë‚´ì—ì„œ ë¶€ëª¨ì—ê²Œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ê±´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤
function Child({ onFetched }) {
  const data = useFetchData();

  useEffect(() => {
    if (data) {
      // ğŸ‡®ğŸ‡¹ ìŠ¤íŒŒê²Œí‹° ì½”ë“œë¥¼ ë§Œë“œëŠ” ê±´ê°€ìš”?
      onFetched(data);
    }
  }, [onFetched, data]);

  return <>{JSON.stringify(data)}</>;
}
```

`React` ì˜ ë°ì´í„°ëŠ” í­í¬ìˆ˜ì²˜ëŸ¼ í˜ëŸ¬ì•¼í•œë‹¤.
ë°ì´í„°ê°€ ë¶€ëª¨ì—ì„œ ìì‹ ë°©í–¥ìœ¼ë¡œ íë¥´ë„ë¡í•´ì•¼ ì—ëŸ¬ ì¶”ì , ìœ ì§€ë³´ìˆ˜, ë””ë²„ê¹… ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤.
> ì¦‰, Soruce of Truth ë¥¼ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤.

ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ì„ ìœ ì§€í•  ìˆ˜ ë°–ì— ì—†ë‹¤ë©´ `useState`, `useEffect` ëŒ€ì‹  ìƒìœ„ì—ì„œ ì •ì˜ëœ í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.
```tsx
// ì œì•ˆ #2 - onSuccess/onError í•¸ë“¤ëŸ¬ë¥¼ ìì‹ ì»´í¬ë„ŒíŠ¸ì— ì „ë‹¬í•©ë‹ˆë‹¤
function Parent() {
    function handleSuccess = (data) => {
        // ì„±ê³µì„ ì²˜ë¦¬í•˜ëŠ” ë¡œì§
    }
    function handleError = (error) => {
        // ì‹¤íŒ¨ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§
        toast(error.messasge)
    }
    // âœ… ì˜¬ë°”ë¥¸ ë°©í–¥ìœ¼ë¡œ ìì‹ì—ê²Œ ë°ì´í„°ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤
    return <Child onSuccess={handleSuccess} onError={handleError} />;
}

function Child({ onSuccess, onError }) {
  // âœ… ë‹¤ë¥¸ ì´í™íŠ¸ëŠ” ê´€ì—¬í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ì„ ë•Œ í•¸ë“¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ëŠ” í›…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
  const mutate = useMutateData({ onSuccess, onError });

  return ...;
}
```

# ì›ë¬¸
https://velog.io/@typo/leave-useeffect-alone