#cassandra #database 
# Cassandra 는?
기존 RDB 가 방대한 데이터 셋과 실시간 요청을 수용하기에 부족할 때 선호되는 솔루션이에요.

분산형 아키텍처는 확장성과 내결함성을 제공하기 때문에 고속, 대규모 애플리케이션에 적합해요.
Cassandra 의 분산형 접근 방식은 단일 장애 지점이 없음을 보장하고 다용도로 사용할 수 있어요.

![[백엔드 개발자면 알아야할 Cassandra-20240509024431882.webp]]

# 용어 소개
![[백엔드 개발자면 알아야할 Cassandra-20240509024452198.webp]]
#### Node
카산드라 데이터베이스 내에 모든 데이터가 저장되는 곳

#### Data Center
연결된 노드의 모음

# 모든 노드에 쓰기작업을 수행하나요?
![[백엔드 개발자면 알아야할 Cassandra-20240509025354202.webp]]

1. 클라이언트가 Coordinator node 에 쓰기작업 수행
2. Co-ordinator 노드는 다른 노드(같은 zone 에 해당되는 영역) 에 쓰기 작업을 수행
   > 각 노드가 데이터를 숫니하면 노드의 커밋 로그에 기록 되요.
3. 데이터를 수신한 노드는 Co-ordinator 노드에 ack 를 응답
4. Co-ordinator 노드가 클라이언트에 ack 반환

또한 카산드라는 복제 계수(RF) 값에 따라서 복제 노드 수를 지정하여 데이터 일관성과 시스템 가용성의 균형을 맞춰요.

# Cassandra 는 어떤 노드가 데이터를 가져올 수 어떻게 결정하나요?

카산드라는 `일관된 해싱 알고리즘` 을 사용하여 노득 나에 데이터를 배포해요.
클러스터의 각 노드에는 해시 값의 범위가 할당됩니다.


# 각 노드는 데이터의 쓰기와 읽기를 어떻게 처리하나요?
> 사용자가 메시지를 게시하고, 게시물에 댓글을 달고, 게시물에 좋아요를 누를 수 있는 소셜 미디어 플랫폼을 구축한다고 가정해 보겠습니다. 이 플랫폼은 방대한 양의 데이터와 높은 사용자 동시성을 처리해야 하므로 Cassandra와 같은 분산형 NoSQL 데이터베이스를 사용하는 것이 필수적입니다.

![[백엔드 개발자면 알아야할 Cassandra-20240509030249150.webp]]

## 쓰기 작업

### Step 1. 파티셔닝 및 복제
모든 쓰기는 파티션 키(예: 사용자 ID)를 기준으로 자동으로 파티션이 지정되고 클러스터의 여러 노드에 복제됩니다. 이를 통해 내결함성과 고가용성이 보장됩니다.  
사용자 A의 글 데이터는 사용자 A의 ID를 기준으로 분할되고 여러 노드에 복제되므로 일부 노드에 장애가 발생하더라도 데이터 손실을 방지할 수 있습니다.

### Step 2. 커밋 로그
사용자가 메시지를 게시할 때마다 쓰기 활동은 Cassandra 클러스터의 여러 노드에 있는 커밋 로그에 캡쳐 되요.
커밋 로그는 쓰기 활동에 대한 불변의 기록 역할을 합니다.
> 예를 들어 사용자 A가 메시지를 게시하면 해당 활동은 내결함성과 내구성을 위해 여러 노드의 커밋 로그에 즉시 기록됩니다.

### Step 3. Mem-table
쓰기 작업은 해당 노드의 커밋 로그에서 인메모리 데이터 구조인 멤-테이블에 저장됩니다. 
멤테이블은 데이터가 메모리에 먼저 기록되므로 빠른 쓰기 작업이 가능합니다.

### Step 4. SSTable Data File
멤테이블이 가득 차면 데이터는 SSTable(정렬된 문자열 테이블) 데이터 파일이라는 온디스크 스토리지 형식으로 플러시됩니다. SSTable은 효율적인 읽기 작업을 가능하게 하는 정렬된 불변 데이터 파일입니다.

# References
### [Cassandra Architecture Every Backend Developer Should Know](https://medium.com/@somalchakrabortyy?source=post_page-----6d9d248a7463--------------------------------)]
