---
tags: multi-threading, concurrency
---
# 멀티스레딩과 동시성 개념

태그: 운영체제
Date: September 7, 2023 12:22 AM
공개 여부: 공개
설명: 두 개념을 헷갈리지 않기
카테고리: 기술 지식

![Untitled](Untitled%20117.png)

## 멀티스레딩이란?

CPU 자원을 최대한 활용하기 위해 프로그램 두 개 이상을 동시에 실행할 수 있는 기술을 의미합니다.

멀티스레딩을 활용하여 한 프로그램에서 코드를 작성하고 다른 프로그램에서 음악을 들을 수 있습니다.

<aside>
💡 프로그램은 프로세스와 스레드로 구성됩니다.

</aside>

### 스레드

스레드는 프로세스의 가장 작은 실행 단위입니다.

프로세스는 하나의 메인 스레드와 함께 여러 개의 스레드를 가지고 있을 수 있습니다.

Chrome.exe 를 예를 들어, 사용자가 현재 보고 있는 탭 스레드 한개와 다른 N개의 탭에 대해서 N개의 스레드가 할당되어 있습니다. ( 1 Tab = 1 Thread )

더 자세한 예시는 [문서](https://learningdaily.dev/multithreading-and-concurrency-fundamentals-fb40a502fdb)에서 ****Example of multithreading**** 구문 확인 바랍니다.

## 왜 멀티스레딩을 사용하나?

멀티 코어 CPU가 등장하면서 멀티 스레딩은 애플리케이션의 효율성 측면에서 매우 중요해졌습니다.

멀티 스레드와 단일 코어를 사용하면 애플리케이션이 멀티태스킹을 하는 것처럼 보이게 하기 위해 앞뒤로 전환해야 합니다.

<aside>
💡 스레드 간 작업 전환을 컨텍스트 스위칭(Context Switching) 이라고 합니다.

</aside>

다중 코어를 사용하면 애플리케이션이 기본 하드웨어를 활용하여 전용 코어를 통해 개별 스레드를 실행할 수 있으므로 애플리케이션의 응답성과 효율성이 향상됩니다.

멀티스레딩을 사용하면 기본적으로 CPU와 다중 코어를 최대한 활용할 수 있으므로 유휴 코어로 인해 미처 활용하지 못한 처리를 진행할 수 있습니다.

개발자는 다음과 같은 이유로 멀티스레딩을 주로 사용하게 됩니다.

- 더 높은 처리량
- 마치 멀티태스킹 하는 듯한 느낌을 주는 반응형 애플리케이션
- 리소스의 효율적인 사용
    
    <aside>
    💡 웹 서버를 예시로 다중 요청을 처리할 때 요청 마다 새 프로세스를 생성하는 대신 스레드를 생성하여 처리하면 리소스를 훨씬 적게 소비합니다.
    
    </aside>
    

## 멀티스레딩의 기본 개념

### 프로그램, 프로세스와 스레드

오늘 날 운영체제는 여러 프로그램을 동시에 실행할 수 있습니다.

예를 들어 브라우저에서 현재 글을 읽고 있지만, 미디어 플레이어(다른 프로그램)에서 음악을 들을 수 도 있죠.

************************************************프로세스************************************************는 실제로 프로그램을 실행하는 대상입니다. ************************************************************************************************

각 프로세스는 스레드라고 하는 동시 하위 작업을 실행할 수 있습니다.

************스레드************는 프로세스의 하위 작업으로, 올바르게 동기화하면 애플리케이션이 모든 작업을 한 번에 수행하는 것 처럼 착각할 수 있습니다.

<aside>
💡 만약 스레드가 없다면 작업 당 하나의 프로그램을 작성하고 프로세로 실행한 다음 OS를 통해 동기화해야해요.

</aside>

### 동시성(Concurrency)

동시성은 프로그램이 마치 동시에 실행하는 것처럼 보이는 성질입니다.

멀티스레딩을 이용하여 동시성을 구현할 수 있으며 실제로 다중 스레드를 이용해 여러 명령을 한 번에 처리하는 병렬성과 헷갈리지 않아야 합니다.

<aside>
💡 동시성과 병렬성은 싱글 코어에서 멀티 스레드를 동작하냐, 멀티 코어에서 멀티 스레드를 동작하냐의 차이입니다.

</aside>

### 잠금(Lock)

Lock 은 멀티스레딩을 가능하게 하는 매우 중요한 기능입니다.

Lock은 실행 스레드가 많은 환경에서 리소스에 대한 액세스를 제한하는 데 사용되는 동기화 기술입니다.

<aside>
💡 Lock 의 가장 대표적인 예시로 Mutex 와 Semaphore 가 존재합니다.

</aside>

### 뮤텍스(Mutex)

이름에서 알 수 있 듯 `상호 배제`를 의미하며, 공유 데이터를 보호하는 목적으로 사용됩니다.

뮤텍스는 오직 하나의 스레드만 리소스에 접근할 수 있도록 허용합니다.

### 안전한 스레드(Thread Safety)

서로 다른 스레드가 동일한 리소스에 접근하여 잘못된 동작을 수행하거나 경쟁 상태나 교착 상태같은 **예측할 수 없는 결과를 초래하지 않도록 하는 개념**입니다.

## 멀티 스레드와 관련된 문제 사항들

### 교착 상태(Deadlock)

두 개 이상의 스레드가 첫 번째 스레드가 필요로 하는 리소스를 두 번째 스레드가 보유하고 있고 두 번째 스레드가 필요로 하는 리소스를 첫 번째 스레드가 보유하고 있기 때문에 **두 개 이상의 스레드가 아무런 진전을 이루지 못할 때** 발생합니다.

**교착 상태를 방지하기 위해서**는 다음과 같은 사항이 있습니다.

- 중첩 Lock 피하기
    - 이것이 교착 상태의 주 된 이유이며, 여러 스레드에 Lock을 부여하는 것을 의미합니다.
    이미 한 스레드에 Lock을 부여한 경우 다른 스레드에 Lock 을 부여하지 마세요.
- 불필요한 Lock 피하기
    - 꼭 필요한 대상만 Lock을 수행해야 합니다. 가능한 Lock 필요성을 줄이는 것이 좋습니다.

### 경쟁 상태(Race Conditions)

공유 자원에 대해 여러 프로세스가 동시에 접근을 시도할 때, 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태를 의미합니다.

경쟁 상태를 방지하는 방법에 대해서 ChatGPT 의 데이터를 첨부하겠습니다.

1. **락(Lock) 사용**: 락을 사용하여 공유 자원에 대한 동시 접근을 제어할 수 있습니다. 스레드는 락을 획득한 후에만 해당 자원에 접근할 수 있고, 사용이 완료되면 락을 해제합니다. 이를 통해 한 번에 하나의 스레드만 공유 자원에 접근하도록 보장할 수 있습니다. 락은 크리티컬 섹션(Critical Section)을 보호하는 데 사용되며, 락의 종류로는 뮤텍스(Mutex)와 세마포어(Semaphore) 등이 있습니다.
2. **원자적 연산(Atomic Operation)**: 원자적 연산은 하나의 연산이 전체적으로 원자적으로 실행되도록 보장하는 연산입니다. 이를 통해 여러 스레드가 동시에 동일한 변수를 수정하는 경우의 경쟁 상태를 방지할 수 있습니다. 원자적 연산은 일부 특정한 CPU 명령어로 제공되거나, 스레드 라이브러리에서 제공하는 원자적 연산 기능을 사용할 수도 있습니다.
3. **조건 변수(Condition Variable)와 대기/신호 기반 동기화**: 조건 변수는 스레드가 특정 조건이 충족될 때까지 기다리도록 할 수 있는 동기화 기법입니다. 스레드는 조건 변수를 기다리는(wait) 상태에 들어갈 수 있고, 다른 스레드는 조건이 충족될 때 조건 변수에 신호를 보내어(wait/signal) 대기 중인 스레드를 깨울 수 있습니다. 이를 통해 스레드 간의 효율적인 작업 조율이 가능합니다.
4. **스레드 로컬 데이터(Thread-local Data)**: 스레드 로컬 데이터는 각 스레드에게 독립적인 데이터 영역을 제공하는 방법입니다. 스레드는 자신의 로컬 데이터에 접근할 수 있으므로 경쟁 상태를 방지할 수 있습니다. 스레드 로컬 데이터는 전역 변수나 공유 자원 대신 스레드 간의 독립적인 작업에 유용합니다.

### 기아 상태(Starvation)

작업이 오래걸리는 스레드 하나때문에 다른 스레드가 공유 리소스에 대한 접근 권한을 얻지 못하는 상태를 의미합니다.

기아 상태를 방지하기 위해서는

재진입 Lock 이나 Mutex 같은 잠금을 활용하는 것입니다.

이렇게 하면 가장 오래 기다리는 스레드에 대해 접근 권한을 부여하는 공정한 Lock 이 작동합니다.

또한 여러 스레드를 동시에 실행하면서 기아 상태를 방지하려면 세마포어를 사용할 수 있습니다.

## 보충해야하는 정보

세마포어, 임계 구역, 동시성, 병렬성에 대한 프로그래밍 언어에서 다루는 방법의 예시

## References

****[[운영체제] 경쟁 상태 (Race Condition)](https://velog.io/@klloo/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B2%BD%EC%9F%81-%EC%83%81%ED%83%9C-Race-Condition)****

****[Multithreading and concurrency fundamentals](https://learningdaily.dev/multithreading-and-concurrency-fundamentals-fb40a502fdb)****