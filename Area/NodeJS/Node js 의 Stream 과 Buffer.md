---
tags: nodejs, stream, buffer
---
# Node.js ì˜ Stream ê³¼ Buffer

íƒœê·¸: Buffer, Node.js, Stream
Date: October 5, 2023 6:00 PM
ê³µê°œ ì—¬ë¶€: ê³µê°œ
ì„¤ëª…: Node.js ë°ì´í„° ì²˜ë¦¬ì™€ í†µì‹ ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œë“¤
ì¹´í…Œê³ ë¦¬: Node.js

![Untitled](Untitled%2085.png)

ë¹„ë””ì˜¤, ëŒ€ìš©ëŸ‰ íŒŒì¼ ê°™ì€ ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ì¡°ì‘í•˜ë ¤ë©´ Node ì˜ `Stream` ì´ í•„ìš”í•©ë‹ˆë‹¤.

Node.js ì˜ `Stream` ëª¨ë“ˆì€ ëª¨ë“  ìŠ¤íŠ¸ë¦¼ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

# Streams ì˜ ìœ í˜•

Node ì—ì„œëŠ” 4 ê°€ì§€ ìœ í˜•ì˜ ìŠ¤íŠ¸ë¦¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

- `Readable Streams` â†’ ì½ì„ ìˆ˜ ìˆëŠ” ë°ì´í„° ìŠ¤íŠ¸ë¦¼
    
    <aside>
    ğŸ’¡ ì˜ˆì‹œ) ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì²­í¬ë¡œ ì½ëŠ” ê²½ìš°
    
    </aside>
    
- `Writeable Streams` â†’ ì“°ê¸°ìš© ë°ì´í„° ìŠ¤íŠ¸ë¦¼
    
    <aside>
    ğŸ’¡ ì˜ˆì‹œ) íŒŒì¼ì— ëŒ€ëŸ‰ì˜ ë°ì´í„° ì“°ê¸° ì‘ì—…
    
    </aside>
    
- `Duplex Streams` â†’ ì½ê¸°/ì“°ê¸°ê°€ ë™ì‹œì— ê°€ëŠ¥í•œ ìŠ¤íŠ¸ë¦¼
    
    <aside>
    ğŸ’¡ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ ì†Œì¼“ ì—°ê²°
    
    </aside>
    
- `Transform Streams`  â†’ ì½ê¸° ë° ì“°ê¸°ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ ì½ê³  ì“°ëŠ” ë™ì•ˆ ë°ì´í„°ë¥¼ ìˆ˜ì • ë° ë³€í™˜í•˜ëŠ” ìŠ¤íŠ¸ë¦¼
    
    <aside>
    ğŸ’¡ ìš”ì²­ ì „ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ë°ì´í„°ë¥¼ ì••ì¶•í•˜ëŠ” ê²½ìš°
    
    </aside>
    

# Streams ì—ì„œ Buffers

Stream ì€ Buffer ë¼ëŠ” ê°œë…ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

**Buffer ëŠ” ìŠ¤íŠ¸ë¦¼ì´ ë°ì´í„°ë¥¼ ì†Œë¹„í•  ë•Œê¹Œì§€ ì¼ë¶€ ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì„ì‹œ ë©”ëª¨ë¦¬ì…ë‹ˆë‹¤.**

ìŠ¤íŠ¸ë¦¼ì—ì„œ Buffer í¬ê¸°ëŠ” ìŠ¤íŠ¸ë¦¼ ì¸ìŠ¤í„´ìŠ¤ì˜ `highWatermark` ì†ì„±ì— ì˜í•´ ê²°ì •ë˜ë©°, ì´ ì†ì„±ì€ ë²„í¼ì˜ í¬ê¸°ë¥¼ ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ë‚˜íƒ€ë‚´ëŠ” ìˆ«ìì…ë‹ˆë‹¤.

Node ì˜ ë²„í¼ ë©”ëª¨ë¦¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ String ê³¼ Buffer ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.

ë²„í¼ ë©”ëª¨ë¦¬ê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ì—ì„œ ì‘ë™í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©° ì´ë ‡ê²Œ í•˜ë ¤ë©´ ìŠ¤íŠ¸ë¦¼ ê°ì²´ì˜ `objectMode` ì†ì„±ì„ true ë¡œ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

ì¼ë¶€ ë°ì´í„°ë¥¼ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ í‘¸ì‹œí•˜ë ¤ê³  í•˜ë©´ ë°ì´í„°ê°€ ìŠ¤íŠ¸ë¦¼ ë²„í¼ë¡œ í‘¸ì‹œë©ë‹ˆë‹¤.

í‘¸ì‹œëœ ë°ì´í„°ëŠ” ë°ì´í„°ê°€ ì†Œë¹„ë  ë•Œê¹Œì§€ ë²„í¼ë¡œ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ ë²„í¼ê°€ ê°€ë“ ì°¬ ìƒíƒœì—ì„œ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°ì´í„°ë¥¼ í‘¸ì‹œí•˜ë ¤ê³  í•˜ë©´ ìŠ¤íŠ¸ë¦¼ì´ í•´ë‹¹ ë°ì´í„°ë¥¼ í—ˆìš©í•˜ì§€ ì•Šê³  í‘¸ì‹œ ì‘ì—…ì— ëŒ€í•´ `false` ê°’ ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

# Streams ê³¼ EventEmitters

Node.js ìŠ¤íŠ¸ë¦¼ì€ `EventEmitter` í´ë˜ìŠ¤ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.

ë°ì´í„°ì™€ ê°™ì€ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ê³  ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ëë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¨ìˆœíˆ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ë ¤ë©´ `stream.on()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.

ì´ë²¤íŠ¸ ì´ë¯¸í„°ì— ëŒ€í•´ ì‚´í´ë³´ë ¤ë©´ ì•„ë˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”

[](https://medium.com/developers-arena/nodejs-event-emitters-for-beginners-and-for-experts-591e3368fdd2)

# Node.js ì—ì„œ Streams ì½ê¸°

ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„°ë¥¼ ì½ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ìŠ¤íŠ¸ë¦¼ì„ ì½ê¸° ìŠ¤íŠ¸ë¦¼ì´ë¼ê³ í•©ë‹ˆë‹¤.

ì½ê¸° ìŠ¤íŠ¸ë¦¼ì€ ì„œë²„ì—ì„œ íŒŒì¼ì„ ì½ê±°ë‚˜ ì˜¨ë¼ì¸ ë™ì˜ìƒì„ ìŠ¤íŠ¸ë¦¬ë°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ëŒ€ìš©ëŸ‰ í…ìŠ¤íŠ¸ íŒŒì¼ì—ì„œ ì½ê¸° ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í•˜ì—¬ ì‹¤ì œë¡œ ë™ì‘í•˜ëŠ” ì˜ˆì œë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

```jsx
import { createReadStream, ReadStream } from 'fs';

var readStream: ReadStream = createReadStream('./data.txt');

readStream.on('data', chunk => {
  console.log('---------------------------------');
  console.log(chunk);
  console.log('---------------------------------');
});

readStream.on('open', () => {
  console.log('Stream opened...');
});

readStream.on('end', () => {
  console.log('Stream Closed...');
});
```

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒ ì½”ë“œê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

```java
Stream opened...
---------------------------------
<Buffer 4c 6f 72 65 6d 20 69 70 73 75 6d 20 64 6f 6c 6f 72 20 73 69 74 20 61 6d 65 74 2c 20 63 6f 6e 73 65 63 74 65 74 75 72 20 61 64 69 70 69 73 63 69 6e 67 ... >
---------------------------------
---------------------------------
<Buffer 74 20 6e 75 6e 63 20 76 69 74 61 65 20 66 65 72 6d 65 6e 74 75 6d 2e 20 49 6e 20 75 74 20 61 72 63 75 20 74 65 6d 70 6f 72 2c 20 66 61 75 63 69 62 75 ... >
---------------------------------
---------------------------------
<Buffer 20 76 69 74 61 65 2c 20 65 67 65 73 74 61 73 20 69 64 20 73 65 6d 2e 20 44 6f 6e 65 63 20 75 74 20 75 6c 74 72 69 63 69 65 73 20 6c 6f 72 65 6d 2c 20 ... >
---------------------------------
Stream Closed...
```

ìŠ¤íŠ¸ë¦¼ì˜ ë²„í¼ ë©”ëª¨ë¦¬ì— ìˆëŠ” ì½˜í…ì¸ ì˜ ë°”ì´íŠ¸ ë°ì´í„°ì¸ ë²„í¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

## readable stream ì¼ì‹œ ì¤‘ì§€ ë° ì¬ì‹œì‘

`pause()`ì™€ `resume()`í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì„ ì¼ì‹œ ì¤‘ì§€ ë° ì¬ì‹œì‘ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`pause()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ìŠ¤íŠ¸ë¦¼ì˜ `resume()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œê¹Œì§€ ë°ì´í„° ì´ë²¤íŠ¸ê°€ íŠ¸ë¦¬ê±°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

# Flowing, Non-Flowing Streams

### Flowing Stream

ìŠ¤íŠ¸ë¦¼ì—ì„œ ë°ì´í„° ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ë“¤ì„ ìˆ˜ ìˆëŠ”(listening) ë°ì´í„°ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì „ë‹¬í•˜ëŠ” ìŠ¤íŠ¸ë¦¼ì…ë‹ˆë‹¤.

### Non-Flowing Stream

ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ í‘¸ì‹œí•˜ì§€ ì•ŠëŠ” ìŠ¤íŠ¸ë¦¼ì…ë‹ˆë‹¤.

ëŒ€ì‹  ë°ì´í„°ë¥¼ ë²„í¼ì— ì €ì¥í•˜ë©°, ë°ì´í„°ë¥¼ ì½ìœ¼ë ¤ë©´ ìŠ¤íŠ¸ë¦¼ì˜ `read()` ë©”ì„œë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì½”ë“œëŠ” ìŠ¤íŠ¸ë¦¼ì˜ ë°ì´í„° ì´ë²¤íŠ¸ë§Œ ìˆ˜ì‹ í•˜ê³  ìŠ¤íŠ¸ë¦¼ì—ì„œ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ ë¦¬ìŠ¤ë„ˆê°€ ìë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë˜ëŠ” `Flowing Stream`ì˜ ì˜ˆì‹œì…ë‹ˆë‹¤.

```jsx
import { createReadStream, ReadStream } from 'fs';

var readStream: ReadStream = createReadStream('./data.txt');

setTimeout(() => {
  const data = readStream.read(10);
  console.log(data);
}, 10);
```

```java
<Buffer 4c 6f 72 65 6d 20 69 70 73 75>
```

ìœ„ ì½”ë“œëŠ” ì–´ë–»ê²Œ ë™ì‘í–ˆì„ê¹Œìš”?

`fs` ëª¨ë“ˆì˜ `createReadStream` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì½ê¸° ìŠ¤íŠ¸ë¦¼ì„ ìƒì„±í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ìŠ¤íŠ¸ë¦¼ì´ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ íŒŒì¼ ë°ì´í„°ê°€ ìŠ¤íŠ¸ë¦¼ ë³€ìˆ˜ë¡œ ìŠ¤íŠ¸ë¦¬ë°ë˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤. 

ë˜í•œ ìŠ¤íŠ¸ë¦¼ì´ `setTimeout` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë²„í¼ì— ë°ì´í„°ë¥¼ ì±„ìš¸ ìˆ˜ ìˆë„ë¡ ì•½ê°„ì˜ ì‹œê°„ì„ í—ˆìš©í–ˆìŠµë‹ˆë‹¤.

# Read Stream  ì— ì˜í•œ ë²„í¼ ê´€ë¦¬

ìœ„ ì˜ˆì‹œ ì½”ë“œì—ì„œ `console.log(data)` ë’¤ì— ë‹¤ì‹œ `read()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì¶œë ¥í•˜ë©´

ì´ì „ ë¡œê·¸ì™€ ë‹¤ë¥¸ ë°ì´í„°ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

```jsx
import { createReadStream, ReadStream } from 'fs';

var readStream: ReadStream = createReadStream('./data.txt');

setTimeout(() => {
  const data = readStream.read(10);
  console.log(data);

  const data2 = readStream.read(10);
  console.log(data2);
}, 10);
```

```jsx
<Buffer 4c 6f 72 65 6d 20 69 70 73 75>
<Buffer 6d 20 64 6f 6c 6f 72 20 73 69> // diff
```

ì´ìœ ëŠ” ì†Œë¹„ì(Consumer) ê°€ ë°ì´í„°ë¥¼ ì½ì€ í›„ ë²„í¼ê°€ ë°ì´í„°ë¥¼ ì œê±°í•˜ê¸° ë•Œë¬¸ì— ê¸°ë¡ë˜ëŠ” ê°’ì´ ë‹¤ë¥¸ê²ë‹ˆë‹¤.

ë”°ë¼ì„œ `read()` ë©”ì„œë“œë¥¼ ì²˜ìŒ í˜¸ì¶œí•˜ë©´ ë²„í¼ ë°ì´í„°ì˜ ì²« 10ë°”ì´íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³ , `read()` ë©”ì„œë“œë¥¼ ë‘ë²ˆ ì§¸ í˜¸ì¶œí–ˆì„ ë•Œ ë²„í¼ì˜ ì²« 10ë°”ì´íŠ¸ì— í•´ë‹¹í•˜ëŠ” ì‹¤ì œ ë°ì´í„°ì˜ **11ë²ˆì§¸ ë°”ì´íŠ¸ë¶€í„° 20ë²ˆì§¸** ë°”ì´íŠ¸ê¹Œì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼, íŒŒì´í•‘ ê·¸ë¦¬ê³  ìŠ¤íŠ¸ë¦¬ë° ê³¼ì •ì—ì„œ ì—ëŸ¬ í•¸ë“¤ë§ì„ ì‚´í´ë³´ë ¤ë©´ ì•„ë˜ ê¸€ì„ ì°¸ê³ í•˜ì„¸ìš”.

[](https://javascript.plainenglish.io/streams-piping-and-their-error-handling-in-nodejs-c3fd818530b6)

# References

**[Streams and Buffers in Node.js - Kunal Tandon](https://javascript.plainenglish.io/streams-and-buffers-in-nodejs-30ff53edd50f)**

**[Node Event Emitters â€” For Beginners and Experts](https://medium.com/developers-arena/nodejs-event-emitters-for-beginners-and-for-experts-591e3368fdd2)**